@model KPIMonitor.ViewModels.OwnerEditorEditVm

<div class="modal fade" id="planEditModal" tabindex="-1" aria-labelledby="peLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content rounded-3">
      <div class="modal-header">
        <h5 class="modal-title" id="peLabel">Edit KPI Year Plan</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <form id="planEditForm" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" name="planId" value="@Model.PlanId" />

        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Frequency</label>
              <input class="form-control" name="frequency" id="pe_frequency"
                     value="@(ViewBag.Frequency ?? "")" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Unit</label>
              <input class="form-control" name="unit" id="pe_unit"
                     value="@(ViewBag.Unit ?? "")" />
            </div>

            <div class="col-md-6">
              <label class="form-label">Annual Target</label>
              <input type="number" step="0.001" class="form-control"
                     name="annualTarget" id="pe_target"
                     value="@(ViewBag.AnnualTargetText ?? "")" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Priority</label>
              <input type="number" class="form-control"
                     name="priority" id="pe_priority"
                     value="@(ViewBag.PriorityText ?? "")" />
            </div>

            <div class="col-md-12">
              <label class="form-label">Target Direction</label>
              <select class="form-select" name="targetDirection" id="pe_targetDirection" required>
                @{
                    var td = (int?)ViewBag.TargetDirection ?? 1;
                }
                <option value="1" selected="@(td == 1 ? "selected" : null)">Higher is better (≥ target)</option>
                <option value="-1" selected="@(td == -1 ? "selected" : null)">Lower is better (≤ target)</option>
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label">Owner</label>
              <select class="form-select" name="ownerEmpId" id="pe_owner">
                <option value="">— Select —</option>
                @foreach (var e in Model.Employees)
                {
                    var isSelected = Model.OwnerEmpId != null &&
                                     string.Equals(Model.OwnerEmpId, e.EmpId, System.StringComparison.OrdinalIgnoreCase);
                    <option value="@e.EmpId" selected="@(isSelected ? "selected" : null)">@e.Label</option>
                }
              </select>
              <div class="form-text">Current: @Model.CurrentOwnerName</div>
            </div>

            <div class="col-md-6">
              <label class="form-label">Editor</label>
              <select class="form-select" name="editorEmpId" id="pe_editor">
                <option value="">— Select —</option>
                @foreach (var e in Model.Employees)
                {
                    var isSelected = Model.EditorEmpId != null &&
                                     string.Equals(Model.EditorEmpId, e.EmpId, System.StringComparison.OrdinalIgnoreCase);
                    <option value="@e.EmpId" selected="@(isSelected ? "selected" : null)">@e.Label</option>
                }
              </select>
              <div class="form-text">Current: @Model.CurrentEditorName</div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
